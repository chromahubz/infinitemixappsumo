[phases.setup]
nixPkgs = ["nodejs_20", "ffmpeg-full"]

[phases.install]
cmds = ["npm install"]

[phases.build]
cmds = [
  "echo '=== Clearing Next.js cache ==='",
  "rm -rf .next",
  "echo '=== Verifying lib/task-store.ts exists ==='",
  "ls -la lib/ | grep task-store || echo 'WARNING: task-store.ts not found!'",
  "echo '=== Preparing environment variables ==='",
  "chmod +x scripts/prepare-env.sh",
  "./scripts/prepare-env.sh",
  "echo '=== Building application ==='",
  "npm run build"
]

[start]
cmd = "./start.sh"
